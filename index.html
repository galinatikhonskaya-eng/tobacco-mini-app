<script>
    // Инициализация Telegram Web App
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
    tg.enableClosingConfirmation();
    console.log('Telegram Web App инициализирован:', tg.initDataUnsafe.user ? tg.initDataUnsafe.user.username : 'Нет пользователя');

    // Показываем модал
    document.getElementById('ageModal').style.display = 'flex';

    // Кнопка "Мне есть 18+"
    document.getElementById('ageConfirm').onclick = function() {
        console.log('Кнопка 18+ нажата!');

        // Скрываем модал
        document.getElementById('ageModal').style.display = 'none';

        // Показываем app и принудительно делаем видимым
        const app = document.getElementById('app');
        app.style.display = 'block';
        app.style.backgroundColor = 'white'; // на случай чёрного фона
        app.style.color = 'black';
        app.style.minHeight = '100vh';
        app.style.visibility = 'visible';

        // Сохраняем подтверждение
        localStorage.setItem('isAdultConfirmed', 'true');

        // Уведомление от Telegram
        tg.showPopup({
            title: 'Добро пожаловать!',
            message: 'Возраст подтверждён. Наслаждайтесь покупками.',
            buttons: [{ type: 'ok' }]
        });

        console.log('App показан, фон принудительно белый');
    };

    // Кнопка "Мне нет 18"
    document.getElementById('ageDeny').onclick = function() {
        console.log('Кнопка Нет 18 нажата');
        tg.showAlert('Доступ запрещён. Приложение закроется.');
        tg.close();
    };

    // Если уже подтверждено (перезагрузка страницы)
    if (localStorage.getItem('isAdultConfirmed') === 'true') {
        document.getElementById('ageModal').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        console.log('Возраст уже подтверждён — модал скрыт');
    }

    // Отладка: если app чёрный — меняем фон body
    document.body.style.backgroundColor = '#f0f0f0'; // светлый фон на всякий случай
</script>