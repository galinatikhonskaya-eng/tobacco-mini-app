<script>
    // === Инициализация Telegram Web App ===
    const tg = window.Telegram.WebApp;
    if (!tg) {
        console.error('Telegram Web App НЕ найден! Открой в Telegram.');
        alert('Ошибка: открой в Telegram!');
    } else {
        tg.ready();
        tg.expand();
        tg.enableClosingConfirmation();
        console.log('Telegram Web App готов. Пользователь:', tg.initDataUnsafe.user?.username || 'Аноним');
    }

    // === Принудительный фикс фона body/html (чтобы не было чёрного) ===
    document.body.style.backgroundColor = '#f8f9fa !important';
    document.body.style.color = '#212529 !important';
    document.documentElement.style.backgroundColor = '#f8f9fa !important';

    // === Показываем модал ===
    document.getElementById('ageModal').style.display = 'flex';

    // === Кнопка "Мне есть 18+" ===
    document.getElementById('ageConfirm').addEventListener('click', function() {
        console.log('=== Кнопка "Мне есть 18+" нажата! ===');

        // Скрываем модал
        document.getElementById('ageModal').style.display = 'none';

        // Показываем app с принудительными стилями
        const app = document.getElementById('app');
        app.style.display = 'block !important';
        app.style.visibility = 'visible !important';
        app.style.opacity = '1 !important';
        app.style.backgroundColor = '#ffffff !important';
        app.style.minHeight = '100vh !important';
        app.style.color = '#000000 !important';

        // Дополнительно фиксим основные контейнеры (на случай, если они скрыты)
        document.querySelectorAll('.screen, .main-content, .navbar').forEach(el => {
            el.style.display = 'block !important';
            el.style.visibility = 'visible !important';
            el.style.opacity = '1 !important';
        });

        // Сохраняем подтверждение
        localStorage.setItem('isAdultConfirmed', 'true');

        // Уведомление от Telegram
        tg.showPopup({
            title: 'Добро пожаловать!',
            message: 'Возраст подтверждён. Магазин открыт!',
            buttons: [{ type: 'ok' }]
        });

        // Задержка для принудительной перерисовки (Telegram иногда тормозит)
        setTimeout(() => {
            app.scrollIntoView();
            console.log('App принудительно показан. display:', app.style.display);
            console.log('body background:', document.body.style.backgroundColor);
        }, 100);

        console.log('=== Контент должен появиться. Если чёрный — проверь CSS на background black ===');
    });

    // === Кнопка "Мне нет 18" ===
    document.getElementById('ageDeny').addEventListener('click', function() {
        console.log('=== Кнопка "Мне нет 18" нажата ===');
        tg.showAlert('Доступ запрещён. Закрываем приложение.');
        tg.close();
    });

    // === Авто-подтверждение при перезагрузке ===
    if (localStorage.getItem('isAdultConfirmed') === 'true') {
        document.getElementById('ageModal').style.display = 'none';
        document.getElementById('app').style.display = 'block !important';
        document.body.style.backgroundColor = '#f8f9fa !important';
        console.log('=== Авто-подтверждение: модал скрыт ===');
    }

    // === Отладка через 3 секунды ===
    setTimeout(() => {
        console.log('Отладка через 3с: app display =', document.getElementById('app').style.display);
        console.log('ageModal display =', document.getElementById('ageModal').style.display);
        console.log('body bg =', document.body.style.backgroundColor);
    }, 3000);
</script>